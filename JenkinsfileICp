pipeline {
    agent any
    parameters {
        string(name: 'ICP_MASTER_CFC', defaultValue: 'cilea3/my-private-repository')
        string(name: 'ICP_MASTER_8001', defaultValue: 'https://172.21.20.136:8001')
        string(name: 'ICP_TOKEN', defaultValue: 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tbWNmZm0iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBjNGEzOWY2LTc2YzEtMTFlNy1hODhjLTAwNTA1NjlhNGJhMiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.Jknkvowh-UF-4mgmi0J5BsrSvpzX8yazAceONtQZ4pb0ZGsOOTcQuClc4KQeszAbBqjOLbj0f9FchphAWfhRU02hLaNqsPRIgBL4HhnJNVUrt5Yox5N2z5EWoDLtVLGP6-Ulkp_7L-wEva2uNd4GI7utbr8wNytO6Fkcym0szmGkKJXJjEuIzH6x4P5dI61uPgbyy3XSEpvgkl1sNGK9LqpFA-GGFg6Lpa6Jt09MDV6XU3eY7ELYx7YzI1QYaNH9GkiinimoU8m9QRuw_NFsQLRGM6w2JIwVRf1Ne1R_7QK6fVIQAw8_k9tNwrSgYCYQEpftH4UebmNx0gmsiu-40A')
    }
    stages {
        stage('Continuous Integration') {
            steps {
                sh '''
                   cd dt-ejb
                   mvn clean install
                   cd ../Rest
                   mvn clean install
                   cd ../web
                   mvn clean install
                   cd ../daytrader-ee6
                   mvn clean verify –Pci-docker
                   cd ..
                   '''
             }
        }
        stage('Continuous Delivery') {
            steps {
                sh '''
                    echo "docker login to repo"
                    docker login -u cilea3 -p cilea3 $ICP_MASTER_CFC
                    echo "docker tag"
                    docker tag demo/daytrader-ee6:1.0-SNAPSHOT $ICP_MASTER_CFC/daytrader-ee6
                    echo "docker push"
                    docker push $ICP_MASTER_CFC/daytrader-ee6
                    echo "OC login"
                    oc login https://ocpmaster.gsic-rh-poc.net:8443 -u cilea -p F@ll2017
                    oc project daytrader
                    oc new-app $ICP_MASTER_CFC/daytrader-ee6 --name=liberty
                '''
            }
        }
    }
}
